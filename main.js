!function(){"use strict";class e{constructor(e,t,s,r,i){let{name:n,link:a,_id:o,handleDeleteClick:l,isLiked:c,handleLikeCard:d}=e;this._name=n,this._link=a,this._id=o,this._handleDeleteClick=l,this._handleLikeCard=d,this._cardSelector=t,this._handleImageClick=s,this._api=r,this._isLiked=c,this._confirmationModal=i}_setEventListeners(){this._likeButton.addEventListener("click",(()=>{this._handleLikeIcon()})),this._deleteButton.addEventListener("click",(()=>{this._confirmationModal.open(this._cardElement,this._id)})),this._cardImageEl.addEventListener("click",(()=>{this._handleImageClick({name:this._name,link:this._link})}))}_handleLikeIcon(){this._handleLikeCard(this._id,this._isLiked).then((()=>{this._isLiked=!this._isLiked,this._likeButton.classList.toggle("card__like-button_active")})).catch((e=>{console.error(e)}))}_handleDeleteCard(){this._cardElement.remove()}_getTemplate(){return this._cardSelector.content.querySelector(".card__list-item").cloneNode(!0)}getView(){return this._cardElement=this._getTemplate(),this._cardImageEl=this._cardElement.querySelector(".card__image"),this._cardNameEl=this._cardElement.querySelector(".card__description-text"),this._likeButton=this._cardElement.querySelector(".card__like-button"),this._deleteButton=this._cardElement.querySelector(".card__delete-button"),this._cardImageEl.src=this._link,this._cardImageEl.alt=this._name,this._cardNameEl.textContent=this._name,this._isLiked&&this._likeButton.classList.add("card__like-button_active"),this._setEventListeners(),this._cardElement}}class t{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._form=t,this._submitButton=this._form.querySelector(this._submitButtonSelector),this._inputEls=[...this._form.querySelectorAll(this._inputSelector)]}_toggleInputError(e){const t=this._form.querySelector(`#${e.id}-error`),s=e.validity.valid;e.classList.toggle(this._inputErrorClass,!s),t.classList.toggle(this._errorClass,!s),t.textContent=s?"":e.validationMessage}_hasInvalidInput(){return!this._inputEls.every((e=>e.validity.valid))}_toggleButtonState(){const e=this._hasInvalidInput();this._submitButton.classList.toggle(this._inactiveButtonClass,e),this._submitButton.disabled=e}_setEventListeners(){this._inputEls.forEach((e=>{e.addEventListener("input",(()=>{this._toggleInputError(e),this._toggleButtonState()}))}))}enableValidation(){this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}resetValidation(){this._toggleButtonState()}}class s{constructor(e){let{modalSelector:t}=e;this._modalElement=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this),this._handleOverlayClose=this._handleOverlayClose.bind(this)}open(){this._modalElement.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose),this._modalElement.addEventListener("click",this._handleOverlayClose)}close(){this._modalElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose),this._modalElement.removeEventListener("click",this._handleOverlayClose)}_handleOverlayClose(e){e.target.classList.contains("modal")&&this.close()}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._modalElement.querySelectorAll(".modal__close").forEach((e=>{e.addEventListener("click",(()=>this.close()))}))}}var r=class extends s{constructor(e,t){super({modalSelector:e}),this._submitButton=this._modalElement.querySelector(".modal__submit"),this._formModal=this._modalElement.querySelector(".modal__form"),this._inputs=this._formModal.querySelectorAll(".modal__input"),this._handleFormSubmit=t,this._handleSavingModifier=()=>{this._submitButton.classList.add("modal__submit_saving")}}_getInputValues(){const e={};return this._inputs.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super.setEventListeners(),this._formModal.addEventListener("submit",(e=>{e.preventDefault();const t=this._getInputValues();this._handleFormSubmit(t),this._handleSavingModifier(),this.close()}))}close(){super.close(),this._formModal.reset()}};const i=document.querySelector("#profile-edit-button"),n=document.querySelector(".profile__name"),a=document.querySelector(".profile__description"),o=document.querySelector("#profile-name-input"),l=document.querySelector("#profile-description-input"),c=document.querySelector("#card-template"),d=document.querySelector(".card__list"),h=document.querySelector("#add-card-button"),_=document.querySelector("#avatar-update-button"),u=document.querySelector(".profile__picture"),m={};var p;p={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit",inactiveButtonClass:"modal__submit_disabled",inputErrorClass:"modal__input_error",errorClass:"modal__error_visible"},Array.from(document.querySelectorAll(p.formSelector)).forEach((e=>{const s=new t(p,e),r=e.id;m[r]=s,s.enableValidation()}));const v=new r("#profile-edit-modal",(function(e){const{name:t,about:s}=e;C.updateProfile({name:t,about:s}).then((e=>{S.setUserInfo(e.name,e.about),v.close()})).catch((e=>{console.error(e)}))})),E=new r("#add-card-modal",(function(e){const{name:t,link:s}=e;C.addItem({name:t,link:s}).then((e=>{L.addItem(e),E.close()})).catch((e=>{console.error(e)}))})),f=new class extends s{constructor(e){super({modalSelector:e})}open(e){let{link:t,name:s}=e;this._modalElement.querySelector(".modal__preview-caption").textContent=s;const r=this._modalElement.querySelector(".modal__preview-image");r.src=t,r.alt=`${s}`,super.open()}}("#preview-image-modal"),k=new r("#avatar-modal",(function(e){const{avatar:t}=e;C.updateAvatar({avatar:t}).then((e=>{S.setUserAvatar(e.avatar),k.close()})).catch((e=>{console.error(e)}))})),b=new class extends s{constructor(e,t){super({modalSelector:e}),this._handleSubmit=t,this._submitButton=this._modalElement.querySelector(".modal__submit")}setEventListeners(){super.setEventListeners(),this._submitButton.addEventListener("click",(e=>{e.preventDefault(),this._handleSubmit(this._cardElement,this._cardId),this.close()}))}open(e,t){this._cardElement=e,this._cardId=t,super.open()}close(){super.close()}}("#confirmation-modal",y);v.setEventListeners(),E.setEventListeners(),f.setEventListeners(),b.setEventListeners(),k.setEventListeners();const S=new class{constructor(e,t,s){this._name=e,this._description=t,this._avatar=s}getUserInfo(){const e={};return e.profileName=this._name.textContent,e.profileDescription=this._description.textContent,e}setUserInfo(e,t){this._name.textContent=e,this._description.textContent=t}setUserAvatar(e){this._avatar.src=e}}(n,a,u),L=new class{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._container=t}renderItems(e){e.forEach((e=>{this._renderer(e,this._container)}))}addItem(e){this._renderer(e,this._container)}}({items:[],renderer:function(t,s){const r=function(t){return new e({...t,handleDeleteClick:y,handleLikeCard:I},c,g,C,b).getView()}(t);s.prepend(r)}},d),C=new class{constructor(e){this.baseUrl=e.baseUrl,this.headers=e.headers}getAppInfo(){return Promise.all([this.getUserInfo(),this.getInitialCards()])}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`).catch((e=>{console.error(e)}))}getInitialCards(){return fetch(`${this.baseUrl}/cards`,{headers:this.headers}).then(this._checkResponse)}getUserInfo(){return fetch(`${this.baseUrl}/users/me`,{headers:this.headers}).then(this._checkResponse)}updateProfile(e){let{name:t,about:s}=e;return fetch(`${this.baseUrl}/users/me`,{method:"PATCH",headers:this.headers,body:JSON.stringify({name:t,about:s})}).then(this._checkResponse)}addItem(e){let{name:t,link:s}=e;return fetch(`${this.baseUrl}/cards`,{headers:this.headers,method:"POST",body:JSON.stringify({name:t,link:s})}).then(this._checkResponse)}deleteCard(e){return fetch(`${this.baseUrl}/cards/${e}`,{method:"DELETE",headers:this.headers}).then(this._checkResponse)}likeCard(e){return fetch(`${this.baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this.headers}).then(this._checkResponse)}unlikeCard(e){return fetch(`${this.baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this.headers}).then(this._checkResponse)}updateAvatar(e){let{avatar:t}=e;return fetch(`${this.baseUrl}/users/me/avatar`,{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:t})}).then(this._checkResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"68ee5cc1-9a6e-42ad-87e2-f7856d8c88ba","Content-Type":"application/json"}});function g(e){f.open({link:e.link,name:e.name,id:e.id})}function y(e,t){C.deleteCard(t).then((()=>{e.remove()})).catch((e=>console.error(e)))}function I(e,t){return t?C.unlikeCard(e):C.likeCard(e)}C.getAppInfo().then((e=>{let[t,s]=e;S.setUserInfo(t.name,t.about),S.setUserAvatar(t.avatar),L.renderItems(s)})).catch((e=>{console.error(e)})),i.addEventListener("click",(()=>{m["edit-profile-form"].resetValidation();const{profileName:e,profileDescription:t}=S.getUserInfo();o.value=e,l.value=t,v.open()})),h.addEventListener("click",(()=>{m["add-card-form"].resetValidation(),E.open()})),_.addEventListener("click",(()=>{m["avatar-form"].resetValidation(),k.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RyxRQUFRLElBRXJCTCxPQUFPQyxHQUFRQyxRQUFRQyxNQUFNRixJQUNsQyxDQUVBLFNBQVN2QixFQUFlMkksRUFBUTVJLEdBQzlCLE9BQUlBLEVBQ0tOLEVBQUl1TCxXQUFXckMsR0FFZmxKLEVBQUlzTCxTQUFTcEMsRUFFeEIsQ0F4REFsSixFQUNHc0ssYUFDQTVJLE1BQUs3QixJQUF1QixJQUFyQjZMLEVBQVVDLEdBQU05TCxFQUN0QnFJLEVBQVNDLFlBQVl1RCxFQUFTeEwsS0FBTXdMLEVBQVMzRCxPQUM3Q0csRUFBU1UsY0FBYzhDLEVBQVNoRCxRQUNoQ0osRUFBUXVCLFlBQVk4QixFQUFNLElBRTNCOUosT0FBT0MsSUFDTkMsUUFBUUMsTUFBTUYsRUFBSSxJQTZGdEI0RSxFQUFrQnRGLGlCQUFpQixTQUFTLEtBQzFDZ0csRUFBZSxxQkFBcUJyQyxrQkFDcEMsTUFBTSxZQUFFNEIsRUFBVyxtQkFBRUMsR0FBdUJzQixFQUFTb0IsY0FDckR6QyxFQUFpQkwsTUFBUUcsRUFDekJHLEVBQXdCTixNQUFRSSxFQUNoQ2dCLEVBQWFyRyxNQUFNLElBR3JCMEYsRUFBYzdGLGlCQUFpQixTQUFTLEtBQ3RDZ0csRUFBZSxpQkFBaUJyQyxrQkFDaENxRCxFQUFhN0csTUFBTSxJQUdyQjJGLEVBQWE5RixpQkFBaUIsU0FBUyxLQUNyQ2dHLEVBQWUsZUFBZXJDLGtCQUM5QjBELEVBQVlsSCxNQUFNLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvTW9kYWwuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL01vZGFsV2l0aEltYWdlLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9Nb2RhbFdpdGhGb3JtLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL01vZGFsV2l0aENvbmZpcm1hdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcbiAgY29uc3RydWN0b3IoXG4gICAgeyBuYW1lLCBsaW5rLCBfaWQsIGhhbmRsZURlbGV0ZUNsaWNrLCBpc0xpa2VkLCBoYW5kbGVMaWtlQ2FyZCB9LFxuICAgIGNhcmRTZWxlY3RvcixcbiAgICBoYW5kbGVJbWFnZUNsaWNrLFxuICAgIGFwaSxcbiAgICBjb25maXJtYXRpb25Nb2RhbFxuICApIHtcbiAgICB0aGlzLl9uYW1lID0gbmFtZTtcbiAgICB0aGlzLl9saW5rID0gbGluaztcbiAgICB0aGlzLl9pZCA9IF9pZDtcbiAgICB0aGlzLl9oYW5kbGVEZWxldGVDbGljayA9IGhhbmRsZURlbGV0ZUNsaWNrO1xuICAgIHRoaXMuX2hhbmRsZUxpa2VDYXJkID0gaGFuZGxlTGlrZUNhcmQ7XG4gICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xuICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2sgPSBoYW5kbGVJbWFnZUNsaWNrO1xuICAgIHRoaXMuX2FwaSA9IGFwaTtcbiAgICB0aGlzLl9pc0xpa2VkID0gaXNMaWtlZDtcbiAgICB0aGlzLl9jb25maXJtYXRpb25Nb2RhbCA9IGNvbmZpcm1hdGlvbk1vZGFsO1xuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX2xpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZUxpa2VJY29uKCk7XG4gICAgfSk7XG4gICAgdGhpcy5fZGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9jb25maXJtYXRpb25Nb2RhbC5vcGVuKHRoaXMuX2NhcmRFbGVtZW50LCB0aGlzLl9pZCk7XG4gICAgfSk7XG4gICAgdGhpcy5fY2FyZEltYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2soeyBuYW1lOiB0aGlzLl9uYW1lLCBsaW5rOiB0aGlzLl9saW5rIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgX2hhbmRsZUxpa2VJY29uKCkge1xuICAgIHRoaXMuX2hhbmRsZUxpa2VDYXJkKHRoaXMuX2lkLCB0aGlzLl9pc0xpa2VkKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICB0aGlzLl9pc0xpa2VkID0gIXRoaXMuX2lzTGlrZWQ7XG4gICAgICAgIHRoaXMuX2xpa2VCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICB9KTtcbiAgfVxuXG4gIF9oYW5kbGVEZWxldGVDYXJkKCkge1xuICAgIHRoaXMuX2NhcmRFbGVtZW50LnJlbW92ZSgpO1xuICB9XG5cbiAgX2dldFRlbXBsYXRlKCkge1xuICAgIHJldHVybiB0aGlzLl9jYXJkU2VsZWN0b3IuY29udGVudFxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlzdC1pdGVtXCIpXG4gICAgICAuY2xvbmVOb2RlKHRydWUpO1xuICB9XG5cbiAgZ2V0VmlldygpIHtcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XG4gICAgdGhpcy5fY2FyZEltYWdlRWwgPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICAgIHRoaXMuX2NhcmROYW1lRWwgPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIuY2FyZF9fZGVzY3JpcHRpb24tdGV4dFwiXG4gICAgKTtcbiAgICB0aGlzLl9saWtlQnV0dG9uID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKTtcbiAgICB0aGlzLl9kZWxldGVCdXR0b24gPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiXG4gICAgKTtcbiAgICB0aGlzLl9jYXJkSW1hZ2VFbC5zcmMgPSB0aGlzLl9saW5rO1xuICAgIHRoaXMuX2NhcmRJbWFnZUVsLmFsdCA9IHRoaXMuX25hbWU7XG4gICAgdGhpcy5fY2FyZE5hbWVFbC50ZXh0Q29udGVudCA9IHRoaXMuX25hbWU7XG4gICAgaWYgKHRoaXMuX2lzTGlrZWQpIHtcbiAgICAgIHRoaXMuX2xpa2VCdXR0b24uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcbiAgICB9XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICByZXR1cm4gdGhpcy5fY2FyZEVsZW1lbnQ7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xyXG4gIGNvbnN0cnVjdG9yKHNldHRpbmdzLCBmb3JtRWwpIHtcclxuICAgIHRoaXMuX2lucHV0U2VsZWN0b3IgPSBzZXR0aW5ncy5pbnB1dFNlbGVjdG9yO1xyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBzZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3RvcjtcclxuICAgIHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MgPSBzZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzO1xyXG4gICAgdGhpcy5faW5wdXRFcnJvckNsYXNzID0gc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzO1xyXG4gICAgdGhpcy5fZXJyb3JDbGFzcyA9IHNldHRpbmdzLmVycm9yQ2xhc3M7XHJcbiAgICB0aGlzLl9mb3JtID0gZm9ybUVsO1xyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2lucHV0RWxzID0gWy4uLnRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9pbnB1dFNlbGVjdG9yKV07XHJcbiAgfVxyXG5cclxuICBfdG9nZ2xlSW5wdXRFcnJvcihpbnB1dEVsKSB7XHJcbiAgICBjb25zdCBlcnJvck1lc3NhZ2VFbCA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcclxuICAgIGNvbnN0IGlzVmFsaWQgPSBpbnB1dEVsLnZhbGlkaXR5LnZhbGlkO1xyXG5cclxuICAgIGlucHV0RWwuY2xhc3NMaXN0LnRvZ2dsZSh0aGlzLl9pbnB1dEVycm9yQ2xhc3MsICFpc1ZhbGlkKTtcclxuICAgIGVycm9yTWVzc2FnZUVsLmNsYXNzTGlzdC50b2dnbGUodGhpcy5fZXJyb3JDbGFzcywgIWlzVmFsaWQpO1xyXG5cclxuICAgIGVycm9yTWVzc2FnZUVsLnRleHRDb250ZW50ID0gIWlzVmFsaWQgPyBpbnB1dEVsLnZhbGlkYXRpb25NZXNzYWdlIDogXCJcIjtcclxuICB9XHJcblxyXG4gIF9oYXNJbnZhbGlkSW5wdXQoKSB7XHJcbiAgICByZXR1cm4gIXRoaXMuX2lucHV0RWxzLmV2ZXJ5KChpbnB1dEVsKSA9PiBpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKTtcclxuICB9XHJcblxyXG4gIF90b2dnbGVCdXR0b25TdGF0ZSgpIHtcclxuICAgIGNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IHRoaXMuX2hhc0ludmFsaWRJbnB1dCgpO1xyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXHJcbiAgICAgIHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MsXHJcbiAgICAgIGhhc0ludmFsaWRJbnB1dFxyXG4gICAgKTtcclxuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IGhhc0ludmFsaWRJbnB1dDtcclxuICB9XHJcblxyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2lucHV0RWxzLmZvckVhY2goKGlucHV0RWwpID0+IHtcclxuICAgICAgaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX3RvZ2dsZUlucHV0RXJyb3IoaW5wdXRFbCk7XHJcbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gIH1cclxuXHJcbiAgcmVzZXRWYWxpZGF0aW9uKCkge1xyXG4gICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kYWwge1xyXG4gIGNvbnN0cnVjdG9yKHsgbW9kYWxTZWxlY3RvciB9KSB7XHJcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG1vZGFsU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5faGFuZGxlRXNjQ2xvc2UgPSB0aGlzLl9oYW5kbGVFc2NDbG9zZS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5faGFuZGxlT3ZlcmxheUNsb3NlID0gdGhpcy5faGFuZGxlT3ZlcmxheUNsb3NlLmJpbmQodGhpcyk7XHJcbiAgfVxyXG5cclxuICBvcGVuKCkge1xyXG4gICAgdGhpcy5fbW9kYWxFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XHJcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2hhbmRsZU92ZXJsYXlDbG9zZSk7XHJcbiAgfVxyXG5cclxuICBjbG9zZSgpIHtcclxuICAgIHRoaXMuX21vZGFsRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xyXG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gICAgdGhpcy5fbW9kYWxFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLl9oYW5kbGVPdmVybGF5Q2xvc2UpO1xyXG4gIH1cclxuXHJcbiAgX2hhbmRsZU92ZXJsYXlDbG9zZShldnQpIHtcclxuICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsXCIpKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9oYW5kbGVFc2NDbG9zZShldnQpIHtcclxuICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgY29uc3QgY2xvc2VCdXR0b25zID0gdGhpcy5fbW9kYWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxfX2Nsb3NlXCIpO1xyXG4gICAgY2xvc2VCdXR0b25zLmZvckVhY2goKGJ1dHRvbikgPT4ge1xyXG4gICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuY2xvc2UoKSk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IE1vZGFsIGZyb20gXCIuL01vZGFsLmpzXCI7XG5cbmNsYXNzIE1vZGFsV2l0aEltYWdlIGV4dGVuZHMgTW9kYWwge1xuICBjb25zdHJ1Y3Rvcihtb2RhbFNlbGVjdG9yKSB7XG4gICAgc3VwZXIoeyBtb2RhbFNlbGVjdG9yIH0pO1xuICB9XG5cbiAgb3Blbih7IGxpbmssIG5hbWUgfSkge1xuICAgIHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19wcmV2aWV3LWNhcHRpb25cIikudGV4dENvbnRlbnQgPVxuICAgICAgbmFtZTtcbiAgICBjb25zdCBpbWFnZSA9IHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19wcmV2aWV3LWltYWdlXCIpO1xuICAgIGltYWdlLnNyYyA9IGxpbms7XG4gICAgaW1hZ2UuYWx0ID0gYCR7bmFtZX1gO1xuICAgIHN1cGVyLm9wZW4oKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBNb2RhbFdpdGhJbWFnZTtcbiIsImltcG9ydCBNb2RhbCBmcm9tIFwiLi9Nb2RhbC5qc1wiO1xuXG5jbGFzcyBNb2RhbFdpdGhGb3JtIGV4dGVuZHMgTW9kYWwge1xuICBjb25zdHJ1Y3Rvcihtb2RhbFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0KSB7XG4gICAgc3VwZXIoeyBtb2RhbFNlbGVjdG9yIH0pO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbiA9IHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXRcIik7XG4gICAgdGhpcy5fZm9ybU1vZGFsID0gdGhpcy5fbW9kYWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG4gICAgdGhpcy5faW5wdXRzID0gdGhpcy5fZm9ybU1vZGFsLnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxfX2lucHV0XCIpO1xuICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQgPSBoYW5kbGVGb3JtU3VibWl0O1xuICAgIHRoaXMuX2hhbmRsZVNhdmluZ01vZGlmaWVyID0gKCkgPT4ge1xuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9fc3VibWl0X3NhdmluZ1wiKTtcbiAgICB9O1xuICB9XG5cbiAgX2dldElucHV0VmFsdWVzKCkge1xuICAgIGNvbnN0IGlucHV0cyA9IHt9O1xuICAgIHRoaXMuX2lucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgaW5wdXRzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWU7XG4gICAgfSk7XG4gICAgcmV0dXJuIGlucHV0cztcbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fZm9ybU1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnN0IGlucHV0cyA9IHRoaXMuX2dldElucHV0VmFsdWVzKCk7XG4gICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KGlucHV0cyk7XG4gICAgICB0aGlzLl9oYW5kbGVTYXZpbmdNb2RpZmllcigpO1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH0pO1xuICB9XG5cbiAgY2xvc2UoKSB7XG4gICAgc3VwZXIuY2xvc2UoKTtcbiAgICB0aGlzLl9mb3JtTW9kYWwucmVzZXQoKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBNb2RhbFdpdGhGb3JtO1xuIiwiaW1wb3J0IENhcmQgZnJvbSBcIi4uL2NvbXBvbmVudHMvQ2FyZC5qc1wiO1xuaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xuaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCB7IHZhbGlkYXRpb25TZXR0aW5ncyB9IGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcbmltcG9ydCBNb2RhbFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Nb2RhbFdpdGhJbWFnZS5qc1wiO1xuaW1wb3J0IE1vZGFsV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvTW9kYWxXaXRoRm9ybS5qc1wiO1xuaW1wb3J0IE1vZGFsV2l0aENvbmZpcm1hdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9Nb2RhbFdpdGhDb25maXJtYXRpb24uanNcIjtcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiO1xuaW1wb3J0IEFwaSBmcm9tIFwiLi4vY29tcG9uZW50cy9BcGkuanNcIjtcblxuLy8gRWxlbWVudHNcblxuY29uc3QgcHJvZmlsZUVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtZWRpdC1idXR0b25cIik7XG5jb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIik7XG5jb25zdCBwcm9maWxlTmFtZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLW5hbWUtaW5wdXRcIik7XG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb25JbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxuKTtcbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKTtcbmNvbnN0IGNhcmRMaXN0RWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpc3RcIik7XG5jb25zdCBhZGRDYXJkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1idXR0b25cIik7XG5jb25zdCBhdmF0YXJCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci11cGRhdGUtYnV0dG9uXCIpO1xuY29uc3QgcHJvZmlsZUF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fcGljdHVyZVwiKTtcblxuLy8gVmFsaWRhdG9yc1xuXG5jb25zdCBmb3JtVmFsaWRhdG9ycyA9IHt9O1xuXG5jb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKHZhbGlkYXRpb25TZXR0aW5ncykgPT4ge1xuICBjb25zdCBmb3JtTGlzdCA9IEFycmF5LmZyb20oXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh2YWxpZGF0aW9uU2V0dGluZ3MuZm9ybVNlbGVjdG9yKVxuICApO1xuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xuICAgIGNvbnN0IHZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHZhbGlkYXRpb25TZXR0aW5ncywgZm9ybUVsZW1lbnQpO1xuICAgIGNvbnN0IGZvcm1JZCA9IGZvcm1FbGVtZW50LmlkO1xuICAgIGZvcm1WYWxpZGF0b3JzW2Zvcm1JZF0gPSB2YWxpZGF0b3I7XG4gICAgdmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcbiAgfSk7XG59O1xuXG5lbmFibGVWYWxpZGF0aW9uKHZhbGlkYXRpb25TZXR0aW5ncyk7XG5cbi8vIENsYXNzIEluc3RhbmNlc1xuXG5jb25zdCBwcm9maWxlTW9kYWwgPSBuZXcgTW9kYWxXaXRoRm9ybShcbiAgXCIjcHJvZmlsZS1lZGl0LW1vZGFsXCIsXG4gIGhhbmRsZVByb2ZpbGVFZGl0U3VibWl0XG4pO1xuY29uc3QgYWRkQ2FyZE1vZGFsID0gbmV3IE1vZGFsV2l0aEZvcm0oXCIjYWRkLWNhcmQtbW9kYWxcIiwgaGFuZGxlQWRkQ2FyZFN1Ym1pdCk7XG5cbmNvbnN0IGltYWdlTW9kYWwgPSBuZXcgTW9kYWxXaXRoSW1hZ2UoXCIjcHJldmlldy1pbWFnZS1tb2RhbFwiKTtcblxuY29uc3QgYXZhdGFyTW9kYWwgPSBuZXcgTW9kYWxXaXRoRm9ybShcIiNhdmF0YXItbW9kYWxcIiwgaGFuZGxlQXZhdGFyU3VibWl0KTtcblxuY29uc3QgY29uZmlybWF0aW9uTW9kYWwgPSBuZXcgTW9kYWxXaXRoQ29uZmlybWF0aW9uKFxuICBcIiNjb25maXJtYXRpb24tbW9kYWxcIixcbiAgaGFuZGxlQ2FyZERlbGV0ZVxuKTtcblxucHJvZmlsZU1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5hZGRDYXJkTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbmltYWdlTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbmNvbmZpcm1hdGlvbk1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5hdmF0YXJNb2RhbC5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyhwcm9maWxlTmFtZSwgcHJvZmlsZURlc2NyaXB0aW9uLCBwcm9maWxlQXZhdGFyKTtcblxuY29uc3Qgc2VjdGlvbiA9IG5ldyBTZWN0aW9uKHsgaXRlbXM6IFtdLCByZW5kZXJlcjogcmVuZGVyQ2FyZCB9LCBjYXJkTGlzdEVsKTtcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjY4ZWU1Y2MxLTlhNmUtNDJhZC04N2UyLWY3ODU2ZDhjODhiYVwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbmFwaVxuICAuZ2V0QXBwSW5mbygpXG4gIC50aGVuKChbdXNlckRhdGEsIGNhcmRzXSkgPT4ge1xuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHVzZXJEYXRhLm5hbWUsIHVzZXJEYXRhLmFib3V0KTtcbiAgICB1c2VySW5mby5zZXRVc2VyQXZhdGFyKHVzZXJEYXRhLmF2YXRhcik7XG4gICAgc2VjdGlvbi5yZW5kZXJJdGVtcyhjYXJkcyk7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5lcnJvcihlcnIpO1xuICB9KTtcblxuLy8gRnVuY3Rpb25zXG5cbmZ1bmN0aW9uIGhhbmRsZUltYWdlQ2xpY2soY2FyZERhdGEpIHtcbiAgaW1hZ2VNb2RhbC5vcGVuKHtcbiAgICBsaW5rOiBjYXJkRGF0YS5saW5rLFxuICAgIG5hbWU6IGNhcmREYXRhLm5hbWUsXG4gICAgaWQ6IGNhcmREYXRhLmlkLFxuICB9KTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlQ2FyZChjYXJkRGF0YSkge1xuICBjb25zdCBjYXJkID0gbmV3IENhcmQoXG4gICAge1xuICAgICAgLi4uY2FyZERhdGEsXG4gICAgICBoYW5kbGVEZWxldGVDbGljazogaGFuZGxlQ2FyZERlbGV0ZSxcbiAgICAgIGhhbmRsZUxpa2VDYXJkOiBoYW5kbGVMaWtlQ2FyZCxcbiAgICB9LFxuICAgIGNhcmRUZW1wbGF0ZSxcbiAgICBoYW5kbGVJbWFnZUNsaWNrLFxuICAgIGFwaSxcbiAgICBjb25maXJtYXRpb25Nb2RhbFxuICApO1xuICByZXR1cm4gY2FyZC5nZXRWaWV3KCk7XG59XG5cbmZ1bmN0aW9uIHJlbmRlckNhcmQoY2FyZERhdGEsIGxpc3RFbCkge1xuICBjb25zdCBjYXJkRWxlbWVudCA9IGNyZWF0ZUNhcmQoY2FyZERhdGEpO1xuICBsaXN0RWwucHJlcGVuZChjYXJkRWxlbWVudCk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUNhcmREZWxldGUoY2FyZEVsZW1lbnQsIGNhcmRJZCkge1xuICBhcGlcbiAgICAuZGVsZXRlQ2FyZChjYXJkSWQpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgY2FyZEVsZW1lbnQucmVtb3ZlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihlcnIpKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlTGlrZUNhcmQoY2FyZElkLCBpc0xpa2VkKSB7XG4gIGlmIChpc0xpa2VkKSB7XG4gICAgcmV0dXJuIGFwaS51bmxpa2VDYXJkKGNhcmRJZCk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGFwaS5saWtlQ2FyZChjYXJkSWQpO1xuICB9XG59XG5cbi8vIEV2ZW50IGhhbmRsZXJzXG5cbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVFZGl0U3VibWl0KGlucHV0VmFsdWVzKSB7XG4gIGNvbnN0IHsgbmFtZSwgYWJvdXQgfSA9IGlucHV0VmFsdWVzO1xuICBhcGlcbiAgICAudXBkYXRlUHJvZmlsZSh7IG5hbWUsIGFib3V0IH0pIC8vIGRlc2NyaXB0aW9uP1xuICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHJlcy5uYW1lLCByZXMuYWJvdXQpO1xuICAgICAgcHJvZmlsZU1vZGFsLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVBZGRDYXJkU3VibWl0KGlucHV0VmFsdWVzKSB7XG4gIGNvbnN0IHsgbmFtZSwgbGluayB9ID0gaW5wdXRWYWx1ZXM7XG4gIGFwaVxuICAgIC5hZGRJdGVtKHsgbmFtZSwgbGluayB9KVxuICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgIHNlY3Rpb24uYWRkSXRlbShyZXMpO1xuICAgICAgYWRkQ2FyZE1vZGFsLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJTdWJtaXQoaW5wdXRWYWx1ZXMpIHtcbiAgY29uc3QgeyBhdmF0YXIgfSA9IGlucHV0VmFsdWVzO1xuICBhcGlcbiAgICAudXBkYXRlQXZhdGFyKHsgYXZhdGFyIH0pXG4gICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgdXNlckluZm8uc2V0VXNlckF2YXRhcihyZXMuYXZhdGFyKTtcbiAgICAgIGF2YXRhck1vZGFsLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIH0pO1xufVxuXG4vLyBFdmVudCBsaXN0ZW5lcnNcblxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgZm9ybVZhbGlkYXRvcnNbXCJlZGl0LXByb2ZpbGUtZm9ybVwiXS5yZXNldFZhbGlkYXRpb24oKTtcbiAgY29uc3QgeyBwcm9maWxlTmFtZSwgcHJvZmlsZURlc2NyaXB0aW9uIH0gPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xuICBwcm9maWxlTmFtZUlucHV0LnZhbHVlID0gcHJvZmlsZU5hbWU7XG4gIHByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlID0gcHJvZmlsZURlc2NyaXB0aW9uO1xuICBwcm9maWxlTW9kYWwub3BlbigpO1xufSk7XG5cbmFkZENhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgZm9ybVZhbGlkYXRvcnNbXCJhZGQtY2FyZC1mb3JtXCJdLnJlc2V0VmFsaWRhdGlvbigpO1xuICBhZGRDYXJkTW9kYWwub3BlbigpO1xufSk7XG5cbmF2YXRhckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBmb3JtVmFsaWRhdG9yc1tcImF2YXRhci1mb3JtXCJdLnJlc2V0VmFsaWRhdGlvbigpO1xuICBhdmF0YXJNb2RhbC5vcGVuKCk7XG59KTtcbiIsIi8vIFZhbGlkYXRpb25cbmNvbnN0IHZhbGlkYXRpb25TZXR0aW5ncyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19zdWJtaXRcIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc3VibWl0X2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiLFxufTtcblxuZXhwb3J0IHsgdmFsaWRhdGlvblNldHRpbmdzIH07XG4iLCJpbXBvcnQgTW9kYWwgZnJvbSBcIi4vTW9kYWxcIjtcblxuY2xhc3MgTW9kYWxXaXRoQ29uZmlybWF0aW9uIGV4dGVuZHMgTW9kYWwge1xuICBjb25zdHJ1Y3Rvcihtb2RhbFNlbGVjdG9yLCBoYW5kbGVTdWJtaXQpIHtcbiAgICBzdXBlcih7IG1vZGFsU2VsZWN0b3IgfSk7XG4gICAgdGhpcy5faGFuZGxlU3VibWl0ID0gaGFuZGxlU3VibWl0O1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbiA9IHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXRcIik7XG4gIH1cblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5faGFuZGxlU3VibWl0KHRoaXMuX2NhcmRFbGVtZW50LCB0aGlzLl9jYXJkSWQpO1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH0pO1xuICB9XG5cbiAgb3BlbihjYXJkRWxlbWVudCwgY2FyZElkKSB7XG4gICAgdGhpcy5fY2FyZEVsZW1lbnQgPSBjYXJkRWxlbWVudDtcbiAgICB0aGlzLl9jYXJkSWQgPSBjYXJkSWQ7XG4gICAgc3VwZXIub3BlbigpO1xuICB9XG5cbiAgY2xvc2UoKSB7XG4gICAgc3VwZXIuY2xvc2UoKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBNb2RhbFdpdGhDb25maXJtYXRpb247XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XG4gIGNvbnN0cnVjdG9yKHByb2ZpbGVOYW1lLCBwcm9maWxlRGVzY3JpcHRpb24sIGF2YXRhcikge1xuICAgIHRoaXMuX25hbWUgPSBwcm9maWxlTmFtZTtcbiAgICB0aGlzLl9kZXNjcmlwdGlvbiA9IHByb2ZpbGVEZXNjcmlwdGlvbjtcbiAgICB0aGlzLl9hdmF0YXIgPSBhdmF0YXI7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICBjb25zdCB1c2VySW5mbyA9IHt9O1xuICAgIHVzZXJJbmZvLnByb2ZpbGVOYW1lID0gdGhpcy5fbmFtZS50ZXh0Q29udGVudDtcbiAgICB1c2VySW5mby5wcm9maWxlRGVzY3JpcHRpb24gPSB0aGlzLl9kZXNjcmlwdGlvbi50ZXh0Q29udGVudDtcbiAgICByZXR1cm4gdXNlckluZm87XG4gIH1cblxuICBzZXRVc2VySW5mbyhuYW1lLCBhYm91dCkge1xuICAgIHRoaXMuX25hbWUudGV4dENvbnRlbnQgPSBuYW1lO1xuICAgIHRoaXMuX2Rlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gYWJvdXQ7XG4gIH1cblxuICBzZXRVc2VyQXZhdGFyKGF2YXRhcikge1xuICAgIHRoaXMuX2F2YXRhci5zcmMgPSBhdmF0YXI7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xuICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBjb250YWluZXIpIHtcbiAgICB0aGlzLl9pdGVtcyA9IGl0ZW1zO1xuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgdGhpcy5fY29udGFpbmVyID0gY29udGFpbmVyO1xuICB9XG5cbiAgcmVuZGVySXRlbXMoaXRlbXMpIHtcbiAgICBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICB0aGlzLl9yZW5kZXJlcihpdGVtLCB0aGlzLl9jb250YWluZXIpO1xuICAgIH0pO1xuICB9XG5cbiAgYWRkSXRlbShpdGVtKSB7XG4gICAgdGhpcy5fcmVuZGVyZXIoaXRlbSwgdGhpcy5fY29udGFpbmVyKTtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgIHRoaXMuYmFzZVVybCA9IG9wdGlvbnMuYmFzZVVybDtcbiAgICB0aGlzLmhlYWRlcnMgPSBvcHRpb25zLmhlYWRlcnM7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRVc2VySW5mbygpLCB0aGlzLmdldEluaXRpYWxDYXJkcygpXSk7XG4gIH1cblxuICBfY2hlY2tSZXNwb25zZShyZXMpIHtcbiAgICBpZiAocmVzLm9rKSB7XG4gICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICB9XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldEluaXRpYWxDYXJkcygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIHVwZGF0ZVByb2ZpbGUoeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgYWJvdXQsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgYWRkSXRlbSh7IG5hbWUsIGxpbmsgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgbGluayxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBkZWxldGVDYXJkKGlkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGxpa2VDYXJkKGlkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuYmFzZVVybH0vY2FyZHMvJHtpZH0vbGlrZXNgLCB7XG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIHVubGlrZUNhcmQoaWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS9jYXJkcy8ke2lkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgdXBkYXRlQXZhdGFyKHsgYXZhdGFyIH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYXZhdGFyIH0pLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJDYXJkIiwiY29uc3RydWN0b3IiLCJfcmVmIiwiY2FyZFNlbGVjdG9yIiwiaGFuZGxlSW1hZ2VDbGljayIsImFwaSIsImNvbmZpcm1hdGlvbk1vZGFsIiwibmFtZSIsImxpbmsiLCJfaWQiLCJoYW5kbGVEZWxldGVDbGljayIsImlzTGlrZWQiLCJoYW5kbGVMaWtlQ2FyZCIsInRoaXMiLCJfbmFtZSIsIl9saW5rIiwiX2hhbmRsZURlbGV0ZUNsaWNrIiwiX2hhbmRsZUxpa2VDYXJkIiwiX2NhcmRTZWxlY3RvciIsIl9oYW5kbGVJbWFnZUNsaWNrIiwiX2FwaSIsIl9pc0xpa2VkIiwiX2NvbmZpcm1hdGlvbk1vZGFsIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiX2xpa2VCdXR0b24iLCJhZGRFdmVudExpc3RlbmVyIiwiX2hhbmRsZUxpa2VJY29uIiwiX2RlbGV0ZUJ1dHRvbiIsIm9wZW4iLCJfY2FyZEVsZW1lbnQiLCJfY2FyZEltYWdlRWwiLCJ0aGVuIiwiY2xhc3NMaXN0IiwidG9nZ2xlIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJfaGFuZGxlRGVsZXRlQ2FyZCIsInJlbW92ZSIsIl9nZXRUZW1wbGF0ZSIsImNvbnRlbnQiLCJxdWVyeVNlbGVjdG9yIiwiY2xvbmVOb2RlIiwiZ2V0VmlldyIsIl9jYXJkTmFtZUVsIiwic3JjIiwiYWx0IiwidGV4dENvbnRlbnQiLCJhZGQiLCJGb3JtVmFsaWRhdG9yIiwic2V0dGluZ3MiLCJmb3JtRWwiLCJfaW5wdXRTZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJfc3VibWl0QnV0dG9uU2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsIl9pbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsIl9pbnB1dEVycm9yQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJfZXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJfZm9ybSIsIl9zdWJtaXRCdXR0b24iLCJfaW5wdXRFbHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiX3RvZ2dsZUlucHV0RXJyb3IiLCJpbnB1dEVsIiwiZXJyb3JNZXNzYWdlRWwiLCJpZCIsImlzVmFsaWQiLCJ2YWxpZGl0eSIsInZhbGlkIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfaGFzSW52YWxpZElucHV0IiwiZXZlcnkiLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJoYXNJbnZhbGlkSW5wdXQiLCJkaXNhYmxlZCIsImZvckVhY2giLCJlbmFibGVWYWxpZGF0aW9uIiwiZSIsInByZXZlbnREZWZhdWx0IiwicmVzZXRWYWxpZGF0aW9uIiwiTW9kYWwiLCJtb2RhbFNlbGVjdG9yIiwiX21vZGFsRWxlbWVudCIsImRvY3VtZW50IiwiX2hhbmRsZUVzY0Nsb3NlIiwiYmluZCIsIl9oYW5kbGVPdmVybGF5Q2xvc2UiLCJjbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJldnQiLCJ0YXJnZXQiLCJjb250YWlucyIsImtleSIsInNldEV2ZW50TGlzdGVuZXJzIiwiYnV0dG9uIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInN1cGVyIiwiX2Zvcm1Nb2RhbCIsIl9pbnB1dHMiLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl9oYW5kbGVTYXZpbmdNb2RpZmllciIsIl9nZXRJbnB1dFZhbHVlcyIsImlucHV0cyIsImlucHV0IiwidmFsdWUiLCJyZXNldCIsInByb2ZpbGVFZGl0QnV0dG9uIiwicHJvZmlsZU5hbWUiLCJwcm9maWxlRGVzY3JpcHRpb24iLCJwcm9maWxlTmFtZUlucHV0IiwicHJvZmlsZURlc2NyaXB0aW9uSW5wdXQiLCJjYXJkVGVtcGxhdGUiLCJjYXJkTGlzdEVsIiwiYWRkQ2FyZEJ1dHRvbiIsImF2YXRhckJ1dHRvbiIsInByb2ZpbGVBdmF0YXIiLCJmb3JtVmFsaWRhdG9ycyIsInZhbGlkYXRpb25TZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsIkFycmF5IiwiZnJvbSIsImZvcm1FbGVtZW50IiwidmFsaWRhdG9yIiwiZm9ybUlkIiwicHJvZmlsZU1vZGFsIiwiTW9kYWxXaXRoRm9ybSIsImlucHV0VmFsdWVzIiwiYWJvdXQiLCJ1cGRhdGVQcm9maWxlIiwicmVzIiwidXNlckluZm8iLCJzZXRVc2VySW5mbyIsImFkZENhcmRNb2RhbCIsImFkZEl0ZW0iLCJzZWN0aW9uIiwiaW1hZ2VNb2RhbCIsImltYWdlIiwiYXZhdGFyTW9kYWwiLCJhdmF0YXIiLCJ1cGRhdGVBdmF0YXIiLCJzZXRVc2VyQXZhdGFyIiwiaGFuZGxlU3VibWl0IiwiX2hhbmRsZVN1Ym1pdCIsImV2ZW50IiwiX2NhcmRJZCIsImNhcmRFbGVtZW50IiwiY2FyZElkIiwiaGFuZGxlQ2FyZERlbGV0ZSIsIl9kZXNjcmlwdGlvbiIsIl9hdmF0YXIiLCJnZXRVc2VySW5mbyIsImNvbnRhaW5lciIsIml0ZW1zIiwicmVuZGVyZXIiLCJfaXRlbXMiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwicmVuZGVySXRlbXMiLCJpdGVtIiwiY2FyZERhdGEiLCJsaXN0RWwiLCJjcmVhdGVDYXJkIiwicHJlcGVuZCIsIm9wdGlvbnMiLCJiYXNlVXJsIiwiaGVhZGVycyIsImdldEFwcEluZm8iLCJQcm9taXNlIiwiYWxsIiwiZ2V0SW5pdGlhbENhcmRzIiwiX2NoZWNrUmVzcG9uc2UiLCJvayIsImpzb24iLCJyZWplY3QiLCJzdGF0dXMiLCJmZXRjaCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiX3JlZjIiLCJkZWxldGVDYXJkIiwibGlrZUNhcmQiLCJ1bmxpa2VDYXJkIiwiX3JlZjMiLCJhdXRob3JpemF0aW9uIiwidXNlckRhdGEiLCJjYXJkcyJdLCJzb3VyY2VSb290IjoiIn0=